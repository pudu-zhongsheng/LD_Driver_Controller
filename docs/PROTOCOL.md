# 通信协议文档

## 1. 通信基础

### 1.1 串口参数
- 波特率: 115200 (驱动器) / 9600 (电子负载/照度计)
- 数据位: 8
- 校验位: 无
- 停止位: 1
- 流控制: 无

### 1.2 通用格式
所有协议都遵循以下基本格式：

## 2. IT8512+ 电子负载协议

### 2.1 基本信息
- 通信方式：串口
- 波特率：9600
- 数据位：8
- 校验位：无
- 停止位：1
- 数据格式：二进制
- 命令长度：26字节

### 2.2 命令格式
| 字节位置 | 内容 | 说明 |
|---------|------|------|
| 0 | 0xAA | 同步头 |
| 1 | 地址 | 0xFF为广播地址 |
| 2 | 命令字 | 具体命令 |
| 3-24 | 数据 | 命令参数 |
| 25 | 校验和 | 前25字节的和 |

### 2.3 命令列表
1. 控制命令 (0x20)
   - 面板/PC控制切换
   - 参数：0=面板，1=PC

2. 输入控制 (0x21)
   - 输入开关控制
   - 参数：0=OFF，1=ON

3. 工作模式 (0x5D)
   - 设置工作模式
   - 参数：
     - 0x00: CV
     - 0x01: CC
     - 0x02: CW
     - 0x03: CR
     - 0x1A: DC
     - 0x1B: DV
     - 0x1C: DW
     - 0x1D: DR

4. 状态查询 (0x5F)
   - 返回设备状态
   - 包含：电压、电流、功率、温度等

### 2.4 错误处理
- 通信超时：100ms
- 校验错误：重发3次
- 命令错误：返回错误码

## 3. LED驱动器协议

### 3.1 基本信息
- 通信方式：串口
- 协议类型：Modbus-RTU
- 波特率：115200
- 数据位：8
- 校验位：无
- 停止位：1

[... 其他协议细节 ...]

[STX] [CMD] [DATA] [CHK] [ETX]
- STX: 起始字符 (0x02)
- CMD: 命令字
- DATA: 数据段
- CHK: 校验和
- ETX: 结束字符 (0x03)

## 4. 照度计协议 (CL-200A)

### 4.1 命令格式
ASCII格式，CR+LF结尾：
CMD + PARAM + CR + LF
### 4.2 主要命令
1. 测量值查询
发送: MES\r\n
返回:
x.xx,y.yy,z.zz\r\n
(照度,色温,色度)

2. 量程切换
发送: RNG,n\r\n
n: 0-4 (量程档位)

## 5. 错误处理

### 5.1 超时处理
- 命令超时: 100ms
- 重试次数: 3次
- 重试间隔: 50ms

### 5.2 错误码
0x01: 命令错误
0x02: 参数错误
0x03: 校验错误
0x04: 执行错误


### 5.3 异常恢复
1. 通信中断
- 自动重连
- 状态重置
- 错误日志

2. 数据错误
- 校验重发
- 状态查询
- 错误记录

## 6. 调试建议

### 6.1 协议调试
- 使用串口调试助手
- 抓包分析
- 日志记录

### 6.2 常见问题
1. 通信无响应
- 检查串口参数
- 验证命令格式
- 检查连接状态

2. 数据异常
- 校验数据格式
- 分析错误码
- 查看设备状态